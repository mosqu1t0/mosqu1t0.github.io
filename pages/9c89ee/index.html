<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tomcat&amp;Servlet | logNCat</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.209c7d81.css" as="style"><link rel="preload" href="/assets/js/app.2cea38e8.js" as="script"><link rel="preload" href="/assets/js/2.f4616c2c.js" as="script"><link rel="preload" href="/assets/js/32.b1e35112.js" as="script"><link rel="prefetch" href="/assets/js/10.d41298bf.js"><link rel="prefetch" href="/assets/js/11.5d3b5ee2.js"><link rel="prefetch" href="/assets/js/12.3d6859bb.js"><link rel="prefetch" href="/assets/js/13.d145c252.js"><link rel="prefetch" href="/assets/js/14.9bdc9be7.js"><link rel="prefetch" href="/assets/js/15.50fbe31f.js"><link rel="prefetch" href="/assets/js/16.17da369e.js"><link rel="prefetch" href="/assets/js/17.3a27af42.js"><link rel="prefetch" href="/assets/js/18.e8053149.js"><link rel="prefetch" href="/assets/js/19.fa086e74.js"><link rel="prefetch" href="/assets/js/20.930eebd5.js"><link rel="prefetch" href="/assets/js/21.46fb8d70.js"><link rel="prefetch" href="/assets/js/22.b1deabe7.js"><link rel="prefetch" href="/assets/js/23.6ac4a21e.js"><link rel="prefetch" href="/assets/js/24.9d8917c8.js"><link rel="prefetch" href="/assets/js/25.6bcd3a57.js"><link rel="prefetch" href="/assets/js/26.3ac8779a.js"><link rel="prefetch" href="/assets/js/27.2e42e259.js"><link rel="prefetch" href="/assets/js/28.65b7ba61.js"><link rel="prefetch" href="/assets/js/29.e4118a49.js"><link rel="prefetch" href="/assets/js/3.bd38c408.js"><link rel="prefetch" href="/assets/js/30.3c83fa09.js"><link rel="prefetch" href="/assets/js/31.e53cd3ee.js"><link rel="prefetch" href="/assets/js/33.a39f50df.js"><link rel="prefetch" href="/assets/js/34.5e827c01.js"><link rel="prefetch" href="/assets/js/35.6b598911.js"><link rel="prefetch" href="/assets/js/36.bdbfec20.js"><link rel="prefetch" href="/assets/js/37.0fed617e.js"><link rel="prefetch" href="/assets/js/38.2fb73efd.js"><link rel="prefetch" href="/assets/js/39.d89ce53d.js"><link rel="prefetch" href="/assets/js/4.8f8d9e03.js"><link rel="prefetch" href="/assets/js/40.43950957.js"><link rel="prefetch" href="/assets/js/41.d6105591.js"><link rel="prefetch" href="/assets/js/42.2e4ba039.js"><link rel="prefetch" href="/assets/js/43.881862db.js"><link rel="prefetch" href="/assets/js/44.a123073e.js"><link rel="prefetch" href="/assets/js/45.4a2dca1e.js"><link rel="prefetch" href="/assets/js/46.ab6570cc.js"><link rel="prefetch" href="/assets/js/47.d5b31756.js"><link rel="prefetch" href="/assets/js/48.2d2bb6b6.js"><link rel="prefetch" href="/assets/js/5.eefe5d85.js"><link rel="prefetch" href="/assets/js/6.e6d51f2f.js"><link rel="prefetch" href="/assets/js/7.4cc231d3.js"><link rel="prefetch" href="/assets/js/8.f98b7ddf.js"><link rel="prefetch" href="/assets/js/9.b7bbc3bf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.209c7d81.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">logNCat</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><a href="/language/" class="link-title">语言</a> <span class="title" style="display:none;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/c&amp;cpp/" class="nav-link">C&amp;Cpp</a></li><li class="dropdown-item"><!----> <a href="/language/bash/" class="nav-link">Bash</a></li><li class="dropdown-item"><!----> <a href="/language/Vimscript/" class="nav-link">Vimscript</a></li><li class="dropdown-item"><!----> <a href="/language/html/" class="nav-link">Html</a></li><li class="dropdown-item"><!----> <a href="/language/css/" class="nav-link">Css</a></li><li class="dropdown-item"><!----> <a href="/language/Javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/language/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/language/go/" class="nav-link">Go</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/database/" class="nav-link">数据库</a></div><div class="nav-item"><a href="/note/" class="nav-link">Note</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="mosqu1t0" class="dropdown-title"><!----> <span class="title" style="display:;">mosqu1t0</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mosqu1t0" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/poem.html" class="nav-link">Poem</a></li></ul></div></div> <a href="https://github.com/mosqu1t0/mosqu1t0.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><a href="/language/" class="link-title">语言</a> <span class="title" style="display:none;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/c&amp;cpp/" class="nav-link">C&amp;Cpp</a></li><li class="dropdown-item"><!----> <a href="/language/bash/" class="nav-link">Bash</a></li><li class="dropdown-item"><!----> <a href="/language/Vimscript/" class="nav-link">Vimscript</a></li><li class="dropdown-item"><!----> <a href="/language/html/" class="nav-link">Html</a></li><li class="dropdown-item"><!----> <a href="/language/css/" class="nav-link">Css</a></li><li class="dropdown-item"><!----> <a href="/language/Javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/language/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/language/go/" class="nav-link">Go</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/database/" class="nav-link">数据库</a></div><div class="nav-item"><a href="/note/" class="nav-link">Note</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="mosqu1t0" class="dropdown-title"><!----> <span class="title" style="display:;">mosqu1t0</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mosqu1t0" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/poem.html" class="nav-link">Poem</a></li></ul></div></div> <a href="https://github.com/mosqu1t0/mosqu1t0.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fbb892/" class="sidebar-link">关于Java的垃圾话</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaSE</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/126b45/" class="sidebar-link">javaSE</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaEE</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9c89ee/" aria-current="page" class="active sidebar-link">Tomcat&amp;Servlet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/9c89ee/#servlet类的映射" class="sidebar-link">Servlet类的映射</a></li><li class="sidebar-sub-header level2"><a href="/pages/9c89ee/#servlet-的生命周期" class="sidebar-link">Servlet 的生命周期</a></li><li class="sidebar-sub-header level2"><a href="/pages/9c89ee/#servlet-生命周期" class="sidebar-link">Servlet 生命周期</a></li><li class="sidebar-sub-header level2"><a href="/pages/9c89ee/#httpservletrequest-对象" class="sidebar-link">HttpServletRequest 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#请求乱码问题" class="sidebar-link">请求乱码问题</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#请求转发" class="sidebar-link">请求转发</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#request-作用域-域对象" class="sidebar-link">request 作用域(域对象)</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/9c89ee/#httpservletresponse-对象" class="sidebar-link">HttpServletResponse 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#响应数据" class="sidebar-link">响应数据</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#响应乱码问题" class="sidebar-link">响应乱码问题</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#getwrite-的字符乱码" class="sidebar-link">getWrite()的字符乱码</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#getoutputstream-字节乱码" class="sidebar-link">getOutputStream()字节乱码</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#重定向" class="sidebar-link">重定向</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/9c89ee/#请求转发和重定向的区别" class="sidebar-link">请求转发和重定向的区别</a></li><li class="sidebar-sub-header level2"><a href="/pages/9c89ee/#cookie-对象" class="sidebar-link">Cookie 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#cookie-的创建和发送" class="sidebar-link">Cookie 的创建和发送</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#cookie-的获取" class="sidebar-link">Cookie 的获取</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#cookie-设置到期时间" class="sidebar-link">Cookie 设置到期时间</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#cookie的注意点" class="sidebar-link">Cookie的注意点</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#cookie-的路径" class="sidebar-link">Cookie 的路径</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/9c89ee/#httpsession对象" class="sidebar-link">HttpSession对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#session-对象作用域" class="sidebar-link">Session 对象作用域</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#session-对象的销毁" class="sidebar-link">Session 对象的销毁</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#默认时间到期" class="sidebar-link">默认时间到期</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#自己设置到期时间" class="sidebar-link">自己设置到期时间</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#立即失效" class="sidebar-link">立即失效</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#关闭浏览器" class="sidebar-link">关闭浏览器</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#关闭服务器" class="sidebar-link">关闭服务器</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#servletcontext-对象" class="sidebar-link">ServletContext 对象</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#servletcontext-对象的获取" class="sidebar-link">ServletContext 对象的获取</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#servletcontext-域对象" class="sidebar-link">ServletContext 域对象</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#返回json" class="sidebar-link">返回Json</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#直接返回纯文本" class="sidebar-link">直接返回纯文本</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#使用三方jar" class="sidebar-link">使用三方jar</a></li><li class="sidebar-sub-header level3"><a href="/pages/9c89ee/#文件的上传和下载" class="sidebar-link">文件的上传和下载</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#文件的上传" class="sidebar-link">文件的上传</a></li><li class="sidebar-sub-header level4"><a href="/pages/9c89ee/#文件的下载" class="sidebar-link">文件的下载</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/categories/?category=language" title="分类" data-v-1baff76c>language</a></li><li data-v-1baff76c><a href="/categories/?category=java" title="分类" data-v-1baff76c>java</a></li></ul> <div class="info" data-v-1baff76c><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2022-05-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Tomcat&amp;Servlet<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="tomcat"><a href="#tomcat" class="header-anchor">#</a> Tomcat</h1> <h1 id="servlet"><a href="#servlet" class="header-anchor">#</a> Servlet</h1> <h2 id="servlet类的映射"><a href="#servlet类的映射" class="header-anchor">#</a> Servlet类的映射</h2> <p>映射一个类的方法有两个</p> <ol><li>写注解, 让tomcat知道应该调用那个类</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/webxxx&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>编辑web.xml, 把映射信息写入</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>4.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>HelloServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>com.servlet.HelloServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>HelloServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="servlet-的生命周期"><a href="#servlet-的生命周期" class="header-anchor">#</a> Servlet 的生命周期</h2> <ol><li><code>init()</code> 创建servlet 实例对象时执行, 只会执行一次</li> <li><code>service()</code> 当有请求访问servlet 时执行, 可执行多次</li> <li><code>destroy()</code> servlet 实例对象删除后执行, 执行一次</li></ol> <h2 id="servlet-生命周期"><a href="#servlet-生命周期" class="header-anchor">#</a> Servlet 生命周期</h2> <ol><li>Web Client 向 Servlet 容器(tomcat) 发出 Http 请求</li> <li>Servlet 接受 Web Client 的请求</li> <li>Servlet 容器创建一个 HttpServletRequest 对象 , 将 Web Client 请求的信息封装到这个对象中</li> <li>Servlet 容器创建一个HttpServletResponse 对象</li> <li>Servlet 容器调用HttpServlet对象 service方法， 把 Request 和 Response 作为参数，传给HttpServlet</li> <li>HttpServlet 调用 HttpServletRequest  对象的有关方法， 获取Http请求信息</li> <li>HttpServlet 调用 HttpServletResponse 对象的有关方法，生成响应数据</li> <li>Servlet 容器 把HttpServlet 的响应结果传给Web Client</li></ol> <h2 id="httpservletrequest-对象"><a href="#httpservletrequest-对象" class="header-anchor">#</a> HttpServletRequest 对象</h2> <p>主要作用是获取Client 发送的各种信息
HttpServletRequest 是 ServletRequest 的子接口, ServletRequest只有一个接口</p> <table><thead><tr><th>方法</th> <th>作用</th></tr></thead> <tbody><tr><td>getRequestURL()</td> <td>获取 请求行完整URL</td></tr> <tr><td>getRequestURI()</td> <td>获取 请求行部分URL(资源名称部分,从项目站点名开始，到？前结束)</td></tr> <tr><td>getRequestString()</td> <td>获取 请求行中的参数部分 从？后开始</td></tr> <tr><td>getMethod()</td> <td>获取 客户端请求的方式</td></tr> <tr><td>getProtocol()</td> <td>获取 HTTP 版本号</td></tr> <tr><td>getContextPath()</td> <td>获取Webapp 名字</td></tr></tbody></table> <blockquote><p>以上为常规方法，返回值为Stringbuffer</p></blockquote> <br> <table><thead><tr><th>方法</th> <th>作用</th></tr></thead> <tbody><tr><td><strong>getParameter()</strong></td> <td>获取指定名称的参数(重要)</td></tr> <tr><td>getParameterValue</td> <td>获取指定名称的参数的所有值</td></tr></tbody></table> <blockquote><p>以上为特殊方法，返回值为String，getParameterValue 返回字符串数组</p></blockquote> <br> <h3 id="请求乱码问题"><a href="#请求乱码问题" class="header-anchor">#</a> 请求乱码问题</h3> <p>由于request接受客户端的参数，所有其默认的语言编码，默认编码为 ISO-8859(此编码不支持中文) 所以会出现乱码，因此需要设置request 的编码，以支持中文。</p> <p>两种方式:</p> <ol><li>设置request 中的编码方式，告诉服务器以何种方式解析数据</li> <li>在接受数据后再通过相应的编码格式还原</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//1.</span>
request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//只针对post有效</span>

<span class="token comment">//2, 针对Tomcat7及以下GET请求的解决办法</span>
<span class="token class-name">String</span> usrName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;usrname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><ol><li>Tomcat8 get 方法输入的中文不会乱码，post会。</li> <li>Tomcat7 及以下 get 方法和 post 方法 都会乱码</li> <li>亲测 Tomcat10 post输入中文也不会乱码</li></ol></blockquote> <h3 id="请求转发"><a href="#请求转发" class="header-anchor">#</a> 请求转发</h3> <p>请求转发是一种服务器行为，当客户端请求到达后，服务器会进行转发，此时会将请求对象进行保存，<strong>地址栏中的URL不会改变</strong>，得到响应后，服务端再将响应发送给客户端，<strong>从始至终只有一个请求发出</strong>，达到多个资源协同响应的效果。</p> <p>可以让请求从服务器跳转到客户端(或跳转到servlet)</p> <p>特点：</p> <ol><li>服务端行为</li> <li>地址栏不会发生改变</li> <li>从始至终只有一个请求</li> <li>数据可以共享</li></ol> <p>实现:</p> <div class="language-java extra-class"><pre class="language-java"><code>request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// url 为要跳转到的 Servlet 或 html  </span>
<span class="token comment">// 给另一个Servlet 传递request 和 response 对象</span>
</code></pre></div><blockquote><p>只能跳转一次，结果会返回，地址栏不变</p></blockquote> <h3 id="request-作用域-域对象"><a href="#request-作用域-域对象" class="header-anchor">#</a> request 作用域(域对象)</h3> <p>通过该对象可以在一个请求中传递数据，作用范围：在一次请求中有效，即服务器跳转有效。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//设置域对象内容</span>
request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Obeject</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取域对象内容</span>
request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//删除域对象内容</span>
request<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>request 域对象中的数据在一次请求中有效，即经过请求转发，request域中的数据依然存在，即在请求转发的过程中可以通过request来传输/共享数据。</p> <h2 id="httpservletresponse-对象"><a href="#httpservletresponse-对象" class="header-anchor">#</a> HttpServletResponse 对象</h2> <p>主要功能用于服务器对客户端的请求进行响应，将Web服务器处理后的结果返回客户端。service()方法中形参接受的是 HttpServletResponse接口的实例化对象，这个对象封装了向客户端发送数据，发送响应头，发送响应状态码的方法。</p> <h3 id="响应数据"><a href="#响应数据" class="header-anchor">#</a> 响应数据</h3> <p>接收到客户端请求后，可以通过 HttpServletResponse 对象直接进行响应，响应时需要获取输出流。</p> <p>有两种形式:</p> <ul><li><strong>getWrite() 获取字符流(只能响应回字符)</strong></li> <li><strong>getOutputStream()获取字节流(能响应一切数据)</strong></li></ul> <blockquote><p>两者不能同时使用，因为response 对象只能响应一次，响应一次后该对象就消失了。</p></blockquote> <p>响应回的数据到客户端被浏览器解析</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">//字符流</span>
<span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">writer</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">writer</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h2&gt;hello&lt;h2&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//字节流</span>
<span class="token class-name">ServletOutputStream</span> out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">writer</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">writer</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h2&gt;hello&lt;/h2&gt;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="响应乱码问题"><a href="#响应乱码问题" class="header-anchor">#</a> 响应乱码问题</h3> <p>如果响应数据中含有中文，则很有可能出现乱码问题
，这是<strong>服务端</strong>和<strong>客户端</strong>的<strong>编码格式不同</strong>造成的。</p> <h4 id="getwrite-的字符乱码"><a href="#getwrite-的字符乱码" class="header-anchor">#</a> getWrite()的字符乱码</h4> <p>对于getWrite()获取到的字符流必定会乱码，由于服务端在进行编码时默认会使用<code>ISO-8859-1</code>格式编码，该编码不支持中文。
要解决这种乱码问题，只能在服务端告知服务器使用一种能支持中文的编码格式，如<code>UTF-8</code>;</p> <p>解决:</p> <ol><li>设置服务端的编码</li> <li>设置客户端的编码</li></ol> <blockquote><p>即设置客户端和服务端一致的编码格式，且支持中文</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 单独设置客户端和服务端的编码格式</span>
<span class="token comment">// 在获取输出流前设置服务端编码格式</span>
response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置客户端的编码格式和响应的MINE类型</span>
response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">// 同时设置客户端和服务端的编码格式</span>
response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="getoutputstream-字节乱码"><a href="#getoutputstream-字节乱码" class="header-anchor">#</a> getOutputStream()字节乱码</h4> <p>由于响应的是字节数据，若服务端与客户端编码不一致同样会出现乱码问题，解决方法与上面是一样的，需要同时设置服务端和客户端的编码格式。</p> <h3 id="重定向"><a href="#重定向" class="header-anchor">#</a> 重定向</h3> <p>重定向是一种服务端指导客户端的行为。客户端发出第一个请求被服务器接受处理后，服务器会进行响应，在响应的同时,服务器会给客户端一个新的地址，保存在location中( 下次请求的地址response.sendRedirect(url)),当客户端接收到响应后，会立刻，马上，自动根据服务给的新地址发起第二个请求，服务器接受请求并作出响应，重定向完成</p> <p>重定向特点：</p> <ol><li>服务端指导，客户端行为</li> <li>存在两次请求</li> <li>地址栏会发生改变</li> <li>request 对象不共享(数据不共享)</li></ol> <blockquote><p>如果不是隐私的信息，其实可以使用<code>resp.sendRedirect(url+&quot;?xxx=xx&quot;);</code>的方式在重定向下传输数据</p></blockquote> <h2 id="请求转发和重定向的区别"><a href="#请求转发和重定向的区别" class="header-anchor">#</a> 请求转发和重定向的区别</h2> <p>请求转发和重定向的比较:</p> <table><thead><tr><th style="text-align:center;">请求转发(req.getRequestDispatcher().forward(req, resp))</th> <th style="text-align:center;">重定向(resp.sendRedirect())</th></tr></thead> <tbody><tr><td style="text-align:center;">一次请求，数据在request 域中共享</td> <td style="text-align:center;">两次请求， request 域中数据不共享</td></tr> <tr><td style="text-align:center;">服务端行为</td> <td style="text-align:center;">客户端行为</td></tr> <tr><td style="text-align:center;">地址栏不改变</td> <td style="text-align:center;">地址栏改变</td></tr> <tr><td style="text-align:center;">绝对地址定位到站点后(无法跨域跳转)</td> <td style="text-align:center;">绝对地址可写到 http://</td></tr></tbody></table> <h2 id="cookie-对象"><a href="#cookie-对象" class="header-anchor">#</a> Cookie 对象</h2> <p>Cookie 是浏览器提供的一种技术，通过服务器能将一些只须保存在客户端，或者在客户端进行处理的数据，放在本地的计算机上，不需要通过网络传输，因而提高网页的处理效率，并且能够减少服务器的负载，但是由于Cookie 是服务端保存客户端的信息，所以其安全性也是很差的。例：常见的记住密码则可以通过Cookie 来实现。</p> <p>专门操作Cookie 的类<code>javaxx.servlet.http.Cookie</code>，随着服务器的响应发送给客户端，保存在浏览器，当下次再访问服务器时把cookie再带回服务器。</p> <p><strong>Cookie 的格式</strong>：键值对用<code>=</code>链接，多个键值对间通过<code>;</code>隔开</p> <h3 id="cookie-的创建和发送"><a href="#cookie-的创建和发送" class="header-anchor">#</a> Cookie 的创建和发送</h3> <p>通过 <code>new Cookie(&quot;key&quot;, &quot;value&quot;);</code>来创建一个cookie对象，要想将cookie随响应发送到客户端，需要先添加到response对象中，<code>response.addCookie(cookie);</code>此时该cookie对象则随着响应发送至了客户端。在浏览器上可以看见。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//创建</span>
<span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//发送</span>
response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cookie-的获取"><a href="#cookie-的获取" class="header-anchor">#</a> Cookie 的获取</h3> <p>在服务端只提供了一个<code>getCookies()</code>的方法来获取客户端回传的所有cookie 组成的一个数组，如果需要获取单个cookie则需要通过遍历，<code>getName(</code>)获取Cookie的名称，<code>getValue()</code>获取cookie的值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//获取cookie数组</span>
<span class="token class-name">Cookie</span> cookies <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//判断数组是否为空</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>cookies <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cookies<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//遍历数组</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cookie</span> cookie <span class="token operator">:</span> cookies<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="cookie-设置到期时间"><a href="#cookie-设置到期时间" class="header-anchor">#</a> Cookie 设置到期时间</h3> <p>除了Cookie的名称和内容外，我们还需要关心一个信息，到期时间，到期时间用来指定该cookie何时失效。默认为当前浏览器关闭即失效，我们可以手动指定到期时间，通过setMaxAge(int time);方法设定cookie 的最大有效时间，以秒为单位。</p> <p><strong>到期时间的取值:</strong></p> <ul><li><p>负整数</p> <p>若为负整数，表示不储存该cookie。cookie 的 maxAge属性的默认值就是-1，表示只在浏览器中存活，一旦关闭浏览器窗口，那么cookie就会消失</p></li> <li><p>正整数</p> <p>若大于0的整数，表示存储的秒数。表示cookie对象可存活指定的秒数。当生命大于0时，浏览器会把Cookie保存到硬盘上，就算关闭浏览器，就算重启客户端电脑，cookie也会存活相应的时间。</p></li> <li><p>零</p> <p>若为0，表示删除该cookie。cookie生命等于0是一个特色的值，它表示cookie被作废，也就是说，如果原来浏览器已经保存了这个cookie，那么可以说通过设置<code>setMaxAge(0)</code>来删除这个cookie。无论在浏览器内存中还是在客户端的硬盘上都会删除这个cookie</p></li></ul> <p><strong>设置cookie对象指定的时间后失效</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//创建cookie对象</span>
<span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置cookie的存活时间</span>
cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//返回cookie</span>
resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cookie的注意点"><a href="#cookie的注意点" class="header-anchor">#</a> Cookie的注意点</h3> <ol><li><p>Cookie保存在当前浏览器中</p> <p>在一般的站点中常常有记住用户名这样一个操作，该操作只是将信息保存在本机上，换电脑以后这些信息就无效了，而且cookie 无法跨浏览器。</p></li> <li><p>Cookie存中文问题</p> <p>cookie 中不能出现中文，如果有中文则通过<code>URLEncoder.encode()</code>来进行编码，获取时通过<code>URLDecoder.decode()</code>解码</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;名字&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token string">&quot;小明&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//编码</span>
name <span class="token operator">=</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
value <span class="token operator">=</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建cookie对象</span>
<span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//获取时通过URLEncoder.decode()来解码</span>
<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token class-name">URLdecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token class-name">URLdecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li><p>同名Cookie问题</p> <p>如果服务器端发送重复的Cookie那么会覆盖原有的cookie</p></li> <li><p>浏览器存放cookie 的数量</p> <p>不同的浏览器对Cookie也有限定，cookie的存储有上限(大小在4kb左右)。Cookie是存在客户端(浏览器里)的，而且一般是由服务器创建和设定。后期结合Session来实现回话追踪。</p></li></ol> <h3 id="cookie-的路径"><a href="#cookie-的路径" class="header-anchor">#</a> Cookie 的路径</h3> <p>Cookie 的setPath设置cookie路径，这个路径直接决定了服务器的请求是否会从浏览器中加载某些cookie。</p> <ol><li>当服务器下任何项目的任意资源都可获取cookie对象</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>当前项目下的资源可获取Cookie对象(默认不设置Cookie的path)</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>指定项目下的资源可获取Cookie对象</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>指定目录下的资源可获取Cookie对象</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/test2/cook4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>  如果设置path，且当前访问的路径包含了cookie的路径(当前访问路径在cookie路径基础上要比cookie的范围小) cookie就会加载到request对象之中</p> <p>  总结：当访问的路径包含了cookie的路径时，则该请求将带上该cookie；如果访问路径不包含cookie路径，则该请求不会携带该cookie</p> <h2 id="httpsession对象"><a href="#httpsession对象" class="header-anchor">#</a> HttpSession对象</h2> <p><strong>HttpSession对象</strong> 是javax.servlet.http.HttpSession的实例，该接口并不像HttpServletRequest或HttpSerletResponse还存在一个父接口，该接口只是一个纯粹的接口。这因为session本身就属于HTTP协议的范畴。</p> <p>  对于服务器而言每一个连接到它的客户端都是一个session，servlet容器使用此接口创建HTTP客户端和HTTP服务器之间的会话。会话将保留指定的时间段，跨多个连接或来自用户的页面请求。一个会话通常对应于一时间和最后一次访问时间。在整个session中，最重要的就是属性的操作。</p> <p>  session 无论客户端还是服务端都可以感知到，若重新打开一个新的浏览器，则无法取得之前设置的session，因为每一个session只保存在当前浏览器中，并在相关的页面取得。</p> <p>  Session 的作用就是为了标识一次会话，或者说确认一个用户；并且在一次会话（一个用户的多次请求）期间共享数据。
我们可以通过request.getSession()方法，来获取当前会话的session对象。</p> <blockquote><p>客户端与服务端进行一次会话以后，每一次请求都要在cookie中带上服务端创建的sessionid</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//获取一个session对象，若session对象存在则获取，不存在则创建</span>
<span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取session的会话标识符</span>
<span class="token class-name">String</span> id <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">getCreationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取最后一次访问时间</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">getLastAccessedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//判断是否是新的session对象</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="session-对象作用域"><a href="#session-对象作用域" class="header-anchor">#</a> Session 对象作用域</h3> <p>  Session 用来表示一次会话，在一次会话中数据是可以共享的，这时session作为域对象存在，可以通过setAttribute(name, value)方法向域对象中添加数据，通过getAttribute(name)从域对象中获取数据，通过removeAttribute(name)从域对象中移除数据。</p> <div class="language-c++ extra-class"><pre class="language-text"><code>//获取一个session对象，若session对象存在则获取，不存在则创建
HttpSession session = request.getSession();

//设置session域对象
session.setAttribute(&quot;uname&quot;, &quot;admin&quot;);

//获取指定名称的session域对象
String uname = (String) request.getAttribute(&quot;uname&quot;);

session.removeAttribute(&quot;uname&quot;);

</code></pre></div><p>  数据储存在session域对象中，当session对象不存在了，或者是两个不同的session对象时，数据也不能共享了。这就不得不谈session的生命周期</p> <h3 id="session-对象的销毁"><a href="#session-对象的销毁" class="header-anchor">#</a> Session 对象的销毁</h3> <h4 id="默认时间到期"><a href="#默认时间到期" class="header-anchor">#</a> 默认时间到期</h4> <p>  当用户第一次请求servlet 并且操作 session 时，session 对象生成，Tomcat中session默认的存活时间为30min，即你不操作界面的时间，一旦有操作，session会重新计时。</p> <p>  session 默认到期时间可以到Tomcat中的conf 目录下的web.xml文件中修改。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- session 默认的最大不活动时间，单位：分钟 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-config</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-timeout</span><span class="token punctuation">&gt;</span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-timeout</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-config</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="自己设置到期时间"><a href="#自己设置到期时间" class="header-anchor">#</a> 自己设置到期时间</h4> <p>  除了以上方法，也可以在程序中自己设置session的生命周期，通过session.setMaxinactiverval(int) 来设定session的最大不活动时间，单位为秒</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//获取指定名称的session域对象</span>
<span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置session的最大不活动时间</span>
session<span class="token punctuation">.</span><span class="token function">setMaxInactiverval</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>  也可以使用<code>getMaxInactiverval()</code>方法来查看当前session对象的最大不活动时间。</p> <h4 id="立即失效"><a href="#立即失效" class="header-anchor">#</a> 立即失效</h4> <p>  或者我们也可以通过session.invalidate()的方法让session立刻失效</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//销毁session对象</span>
session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="关闭浏览器"><a href="#关闭浏览器" class="header-anchor">#</a> 关闭浏览器</h4> <p>  从前面的JESSION可知道，session的底层依赖cookie实现，并且该cookie的有效时间为关闭浏览器，从而session在浏览器关闭时也失效了(因为没有JESSION再与之对应)</p> <h4 id="关闭服务器"><a href="#关闭服务器" class="header-anchor">#</a> 关闭服务器</h4> <h3 id="servletcontext-对象"><a href="#servletcontext-对象" class="header-anchor">#</a> ServletContext 对象</h3> <p>  每一个web应用都有且仅有一个ServletContext对象，又称Application对象，从名称中可知，该对象是与应用程序相关信息。例如可以通过<code>getSerInfo()</code>方法获取当前服务器的信息，<code>getRealPath(String path)</code>获取资源的真实路径等。</p> <h4 id="servletcontext-对象的获取"><a href="#servletcontext-对象的获取" class="header-anchor">#</a> ServletContext 对象的获取</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//通过</span>
<span class="token class-name">ServletContext</span> servletContext1 <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//通过session对象获取</span>
<span class="token class-name">ServletContext</span> servletContext2 <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//通过ServletConfig对象获取</span>
<span class="token class-name">ServletContext</span> servletContext3 <span class="token operator">=</span> getServletConfig<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//直接获取(只能在servlet方法中获取)</span>

<span class="token class-name">ServletContext</span> servletContext4 <span class="token operator">=</span> <span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//常用方法</span>
<span class="token comment">//1.获取当前服务器的版本信息</span>
<span class="token class-name">String</span> servletInfo <span class="token operator">=</span> request<span class="token punctuation">.</span>getServletContext<span class="token punctuation">.</span><span class="token function">getServletInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前服务器的版本信息：&quot;</span> <span class="token operator">+</span> servletInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.获取项目的真实路径</span>
<span class="token class-name">String</span> realPath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span> <span class="token operator">+</span> realPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="servletcontext-域对象"><a href="#servletcontext-域对象" class="header-anchor">#</a> ServletContext 域对象</h4> <p>  ServletContext也可以当作域对象来使用，通过向ServletContext中储存数据，可以使得整个应用程序共享某些数据。当然不建议存放过多数据，因为ServletContext中的数据一旦存储进去没有手动移除将会一直保存。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//获取ServletContext对象</span>
<span class="token class-name">SevletContext</span> servletContext <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置域对象</span>
servletContext<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取域对象</span>
<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> servletContext<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 移除域对象</span>
servletContext<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>servlet的三大域对象</p> <p>1.request域对象<br>
在一次请求中有效。请求转发有效，重定向失效。</p> <p>2.session域对象<br>
在一次会话中有效。请求转发和重定向有效，session销毁后失效</p> <p>3.servletContext域对象<br>
在整个应用程序中有效。服务器关闭后失效</p></blockquote> <blockquote><p>领域越大，占用内存的时间越长，尽量使用范围小的域对象</p></blockquote> <h3 id="返回json"><a href="#返回json" class="header-anchor">#</a> 返回Json</h3> <h4 id="直接返回纯文本"><a href="#直接返回纯文本" class="header-anchor">#</a> 直接返回纯文本</h4> <p>优点是简单，缺点是要手动重写toString方法，如果有很多类要传输，需要重写所有的类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>updownloadfiles<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/json&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Json</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
       resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置返回的头文件为json</span>
       resp<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;{\&quot;年龄\&quot;:\&quot;admin\&quot;, \&quot;年龄\&quot;:\&quot;18\&quot;}&quot;</span><span class="token punctuation">;</span>

       out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
       out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="使用三方jar"><a href="#使用三方jar" class="header-anchor">#</a> 使用三方jar</h4> <p>有很多已经完善好的包可以使用(fastjson, gson，jackson等)，快捷方便地把对象转换为json格式</p> <p>仅以fastjson为例</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xxxx<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/json&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Json</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HashMap</span> usr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        usr<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        usr<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mosquito&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;255&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> json <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>usr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="文件的上传和下载"><a href="#文件的上传和下载" class="header-anchor">#</a> 文件的上传和下载</h3> <h4 id="文件的上传"><a href="#文件的上传" class="header-anchor">#</a> 文件的上传</h4> <p>  文件上传涉及前台页面的编写和后台服务器端代码的编写，前台发送文件，后台接收并保存文件，这才是一个完整的文件上传。</p> <h5 id="前台页面"><a href="#前台页面" class="header-anchor">#</a> 前台页面</h5> <p>  做文件上传的时候，会有一个上传文件的界面，首先我们需要一个表单，并且表单的请求方式是<strong>POST</strong>;其次我们的form表单的entype必须设为&quot;multipart/form-data&quot;，即<code>entype=&quot;multipart/form-data&quot;</code>意思是设置表单的类型为文件上传表单。默认情况下这个表单的类型是<code>application/x-www-form-urlencoded</code>，不能用于文件的上传。只有使用了multipart/form-data才能完整地传递文件数据。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       Name : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>usrname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
       File : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>afile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="后台实现"><a href="#后台实现" class="header-anchor">#</a> 后台实现</h5> <p>  使用注解<code>@MultipartConfig</code>将一个Servlet标识为支持文件上传。Servlet将multipart/form-data的POST请求封装成Part，通过Part对上传文件进行操作。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MultipartConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">Part</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@MultipartConfig</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Upload</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;file uploading...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        req<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//设置编码</span>

        <span class="token class-name">String</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;usrname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Part</span> part <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getPart</span><span class="token punctuation">(</span><span class="token string">&quot;afile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> fileName <span class="token operator">=</span> part<span class="token punctuation">.</span><span class="token function">getSubmittedFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//获取上传文件名称</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span>  req<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        part<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>filePath <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tomcat10 在filePath中已经自带'/'</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;saving : &quot;</span> <span class="token operator">+</span> filePath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="文件的下载"><a href="#文件的下载" class="header-anchor">#</a> 文件的下载</h4> <p>  文件下载，即将服务器上的资源下载(拷贝)到本地，我们可以通过两种方式下载。</p> <h5 id="超链接下载"><a href="#超链接下载" class="header-anchor">#</a> 超链接下载</h5> <p>  当我们在HTML或JSP页面中使用a标签时，愿意是希望进行跳转，但当超链接遇到浏览器不识别的资源时会自动下载；当浏览器能够直接显示的资源，浏览器就会默认显示出来，比如txt、png、jpg等。当然我们也可以通过download属性规定浏览器进行下载，但有的浏览器不支持。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--默认下载--&gt;</span>
<span class="token comment">&lt;!--当超链接遇到浏览器不识别的资源时，会自动下载--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text.txt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>超链接下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--指定download属性下载--&gt;</span>
<span class="token comment">&lt;!-- 当超链接遇到浏览器识别的资源时，默认不会下载。通过download属性下载--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text.txt<span class="token punctuation">&quot;</span></span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>whatis.txt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>超链接下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>  download属性可以不写任何信息，会自动使用默认文件名。如果设置了download属性的值，则使用设置的值作为文件名。当用户打开浏览器点击超链接，就会下载此文件。</p> <h5 id="后台实现下载"><a href="#后台实现下载" class="header-anchor">#</a> 后台实现下载</h5> <p>步骤</p> <ol><li>需要通过<code>resp.setContentType()</code>方法设置Content-type头字段的值，为浏览器无法使用某种方式或激活某个程序来处理MIME类型，例如<code>application/octet-stream</code>或<code>application/x-msdownload</code>等</li> <li>需要通过resp.setHeader方法设置<code>Content-Disposition</code>头的值为<code>attchment;filename=文件名</code>
3.读取文件，调用resp.getOutputStream方法向客户端写入附件内容。</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/download&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Download</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        req<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//设置客户端编码</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置返回编码</span>
        <span class="token class-name">String</span> fileName <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取文件名</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//.trim去除首尾空格</span>
        <span class="token punctuation">{</span>
            resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;fileName can't be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> file<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/octet-stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置文件类型为浏览器无法识别</span>
            resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-Disposition&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attchment;filename=&quot;</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回头中写如文件名</span>

            <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ServletOutputStream</span> os <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;The file does not exists, please try again.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><!----></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/mosqu1t0/mosqu1t0.github.io/edit/master/docs/language/java/Tomcat&amp;Servlet.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/126b45/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">javaSE</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/126b45/" class="prev">javaSE</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/poem.html"><div>
            
            <!----></div></a> <span class="date"></span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/cc7867/"><div>
            后端路线
            <!----></div></a> <span class="date">05-26</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/9a9f04/"><div>
            Websocket
            <!----></div></a> <span class="date">05-26</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>博客内容属于mosqu1t0所有</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><div></div></div></div>
    <script src="/assets/js/app.2cea38e8.js" defer></script><script src="/assets/js/2.f4616c2c.js" defer></script><script src="/assets/js/32.b1e35112.js" defer></script>
  </body>
</html>
